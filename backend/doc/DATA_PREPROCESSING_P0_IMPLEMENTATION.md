# æ•°æ®é¢„å¤„ç† P0 ä¼˜å…ˆçº§å®æ–½æ€»ç»“

## å®æ–½æ—¥æœŸ
2025-11-18

## å®æ–½å†…å®¹

æ ¹æ® `DATA_PREPROCESSING_GUIDE.md` ä¸­çš„å»ºè®®ï¼Œå®Œæˆäº† P0 ä¼˜å…ˆçº§ä»»åŠ¡ï¼Œç«‹å³æ”¹å–„ AI å¤„ç†å¤æ‚æ•°æ®æ–‡ä»¶çš„èƒ½åŠ›ã€‚

---

## 1. å¢å¼º AI Promptï¼ˆæ•°æ®å¤„ç†æŒ‡å¯¼ï¼‰âœ…

**æ–‡ä»¶**ï¼š`backend/src_agent/prompt.py`

**ä¿®æ”¹å†…å®¹**ï¼š

æ·»åŠ äº†å…¨æ–°çš„ç¬¬4èŠ‚"**æ•°æ®é¢„å¤„ç†ä¸æ¸…æ´—**"ï¼ŒåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

### a) æ£€æŸ¥æ–‡ä»¶ç»“æ„
- æ•™ä¼š AI åœ¨è¯»å– Excel æ–‡ä»¶å‰å…ˆæ£€æŸ¥åŸå§‹ç»“æ„
- ä½¿ç”¨ `pd.read_excel(header=None)` æŸ¥çœ‹å‰10è¡Œ
- è¯†åˆ«å…ƒä¿¡æ¯ã€è¡¨å¤´ä½ç½®

### b) å¤„ç†å¤šå±‚è¡¨å¤´å’Œè·³è¿‡è¯´æ˜è¡Œ
- ä½¿ç”¨ `header=4` æŒ‡å®šè¡¨å¤´è¡Œ
- ä½¿ç”¨ `skiprows=5` è·³è¿‡è¯´æ˜è¡Œ
- ä½¿ç”¨ `header=[0, 1, 2]` å¤„ç†å¤šå±‚è¡¨å¤´

### c) æ¸…ç†åˆ—å
- ç§»é™¤ BOM å’Œç‰¹æ®Šå­—ç¬¦ï¼š`df.columns.str.strip()`
- å¤„ç† Unnamed åˆ—ï¼š`~df.columns.str.contains('^Unnamed')`
- ç®€åŒ–åˆ—åï¼šæ›¿æ¢ç©ºæ ¼ã€è½¬å°å†™

### d) æ•°æ®ç±»å‹è½¬æ¢
- æ•°å€¼åˆ—è½¬æ¢ï¼š`pd.to_numeric(errors='coerce')`
- æ—¥æœŸåˆ—è½¬æ¢ï¼š`pd.to_datetime(errors='coerce')`
- æ¸…ç†ç‰¹æ®Šå­—ç¬¦ï¼šå¤„ç†é€—å·ã€ç™¾åˆ†å·ç­‰

### e) æ£€æŸ¥æ•°æ®å®Œæ•´æ€§ï¼ˆç»˜å›¾å‰å¿…åšï¼‰
- æ£€æŸ¥åˆ—åï¼š`df.columns.tolist()`
- æ£€æŸ¥ç¼ºå¤±å€¼ï¼š`df.isnull().sum()`
- æ£€æŸ¥æ•°æ®ç±»å‹ï¼š`df.dtypes`
- æ£€æŸ¥å”¯ä¸€å€¼ï¼š`df['åˆ—'].value_counts()`

### f) ç»˜å›¾å‰çš„æ•°æ®è½¬æ¢ï¼ˆå®½è¡¨è½¬é•¿è¡¨ï¼‰
- ä½¿ç”¨ `df.melt()` è½¬æ¢å®½è¡¨ä¸ºé•¿è¡¨
- è¯¦ç»†ç¤ºä¾‹å’Œå‚æ•°è¯´æ˜
- Tidy data æ¦‚å¿µ

### g) ç»˜å›¾æ—¶çš„å…³é”®æ³¨æ„äº‹é¡¹
- âŒ é”™è¯¯ç¤ºä¾‹ï¼šä½¿ç”¨ä¸å­˜åœ¨çš„åˆ—å
- âœ… æ­£ç¡®åšæ³•ï¼š
  1. å…ˆæ£€æŸ¥å¯ç”¨åˆ—å
  2. ä½¿ç”¨å®é™…å­˜åœ¨çš„åˆ—å
  3. å¦‚éœ€åˆ›å»ºæ–°åˆ—å†ç»˜å›¾

**å½±å“èŒƒå›´**ï¼š
- AI ç°åœ¨èƒ½å¤Ÿä¸»åŠ¨æ£€æŸ¥æ•°æ®æ–‡ä»¶ç»“æ„
- åœ¨é‡åˆ°å¤šå±‚è¡¨å¤´ã€Unnamed åˆ—ç­‰é—®é¢˜æ—¶ï¼ŒçŸ¥é“å¦‚ä½•å¤„ç†
- ç»˜å›¾å‰ä¼šå…ˆéªŒè¯åˆ—åæ˜¯å¦å­˜åœ¨
- èƒ½å¤Ÿæ­£ç¡®å¤„ç†å®½è¡¨åˆ°é•¿è¡¨çš„è½¬æ¢

**ä»£ç é‡**ï¼š
- æ–°å¢çº¦ **110 è¡Œ** prompt æŒ‡å¯¼
- åŒ…å« **16 ä¸ªä»£ç ç¤ºä¾‹**

---

## 2. åˆ›å»ºç”¨æˆ·æ–‡æ¡£ï¼ˆç”¨æˆ·æ•°æ®å‡†å¤‡æŒ‡å—ï¼‰âœ…

**æ–‡ä»¶**ï¼š`backend/DATA_PREPARATION.md`

**æ–‡æ¡£ç»“æ„**ï¼š

### ç›®å½•
1. å¸¸è§é—®é¢˜
2. å¿«é€Ÿæ£€æŸ¥æ¸…å•
3. è¯¦ç»†å¤„ç†æ­¥éª¤
4. ç¤ºä¾‹åœºæ™¯
5. å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ
6. æœ€ä½³å®è·µå»ºè®®

### ä¸»è¦å†…å®¹

#### å¸¸è§é—®é¢˜ï¼ˆ3ä¸ªå…¸å‹é—®é¢˜ï¼‰
1. Excelæ–‡ä»¶æ— æ³•æ­£ç¡®è¯»å–
2. ç»˜å›¾æ—¶æç¤ºåˆ—åä¸å­˜åœ¨
3. æ•°å€¼è®¡ç®—é”™è¯¯

#### å¿«é€Ÿæ£€æŸ¥æ¸…å•
æä¾›7ä¸ªæ£€æŸ¥é¡¹ï¼š
- æ–‡ä»¶æ ¼å¼
- è¡¨å¤´ä½ç½®
- åˆ—åç®€æ´
- å•å±‚è¡¨å¤´
- æ•°æ®ç±»å‹
- æ— ç©ºè¡Œç©ºåˆ—
- ç¼–ç æ­£ç¡®

#### è¯¦ç»†å¤„ç†æ­¥éª¤ï¼ˆ5ä¸ªæ­¥éª¤ï¼‰
1. å¤„ç†å¤šå±‚è¡¨å¤´ï¼ˆ2ç§æ–¹æ³•ï¼‰
2. æ£€æŸ¥å’Œæ¸…ç†åˆ—å
3. æ•°æ®ç±»å‹è½¬æ¢
4. å®½è¡¨è½¬é•¿è¡¨ï¼ˆç”¨äºç»˜å›¾ï¼‰
5. æ¯ä¸ªæ­¥éª¤éƒ½æœ‰ AI äº¤äº’ç¤ºä¾‹

#### ç¤ºä¾‹åœºæ™¯ï¼ˆ2ä¸ªå®Œæ•´åœºæ™¯ï¼‰
1. åœºæ™¯1ï¼šåˆ†æå¤æ‚çš„Excelé”€å”®æŠ¥è¡¨
   - å®Œæ•´çš„5æ­¥å¤„ç†æµç¨‹
   - ä»æ£€æŸ¥åˆ°åˆ†æçš„å…¨è¿‡ç¨‹

2. åœºæ™¯2ï¼šç»˜åˆ¶å¤šæ—¶é—´ç‚¹è¶‹åŠ¿å›¾
   - å®½è¡¨è½¬é•¿è¡¨çš„å®é™…æ¡ˆä¾‹

#### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆï¼ˆ4ä¸ªé”™è¯¯ï¼‰
1. UnicodeDecodeError
2. KeyError: 'column_name'
3. TypeError: unsupported operand
4. æ‰€æœ‰åˆ—éƒ½æ˜¯ Unnamed

#### æœ€ä½³å®è·µå»ºè®®ï¼ˆ6æ¡ï¼‰
1. ä¼˜å…ˆä½¿ç”¨CSVæ ¼å¼
2. ä¿æŒæ•°æ®ç®€æ´
3. åˆ—åè§„èŒƒ
4. æ•°æ®ç±»å‹æ˜ç¡®
5. å…ˆæ¸…æ´—ï¼Œååˆ†æ
6. åˆ©ç”¨AIåŠ©æ‰‹

**æ–‡æ¡£ç‰¹ç‚¹**ï¼š
- ç”¨æˆ·å‹å¥½ï¼ŒéæŠ€æœ¯äººå‘˜ä¹Ÿèƒ½ç†è§£
- æä¾›å…·ä½“çš„ AI äº¤äº’ç¤ºä¾‹ï¼ˆç›´æ¥å¯ç”¨çš„æé—®è¯­å¥ï¼‰
- æ¶µç›–ä»é—®é¢˜è¯†åˆ«åˆ°è§£å†³çš„å®Œæ•´æµç¨‹
- åŒ…å«çœŸå®åœºæ™¯å’Œé”™è¯¯å¤„ç†

**æ–‡æ¡£é‡**ï¼š
- çº¦ **400 è¡Œ** Markdown æ–‡æ¡£
- åŒ…å« **20+ ä¸ªä»£ç ç¤ºä¾‹**
- **10+ ä¸ªè¡¨æ ¼å’Œç¤ºä¾‹æ•°æ®**

---

## 3. æ•ˆæœéªŒè¯

### é¢„æœŸæ”¹è¿›

#### å¯¹äº LEGO æ•°æ®é—®é¢˜
ä¹‹å‰çš„é”™è¯¯ï¼š
```
ValueError: Could not interpret value 'passion_ç³»åˆ—' for 'x'
```

ç°åœ¨ AI ä¼šï¼š
1. å…ˆæ£€æŸ¥ lego.xlsx çš„æ–‡ä»¶ç»“æ„
2. è¯†åˆ«å¤šå±‚è¡¨å¤´ï¼ˆè¡Œ2-5ï¼‰
3. æ­£ç¡®å¤„ç† Unnamed åˆ—
4. åœ¨ç»˜å›¾å‰æ£€æŸ¥å®é™…åˆ—å
5. åªä½¿ç”¨å­˜åœ¨çš„åˆ—åï¼Œæˆ–å…ˆåˆ›å»ºæ–°åˆ—

#### é€šç”¨æ•°æ®å¤„ç†èƒ½åŠ›æå‡
- âœ… èƒ½å¤Ÿå¤„ç†å¤šå±‚è¡¨å¤´çš„ Excel æ–‡ä»¶
- âœ… èƒ½å¤Ÿå¤„ç†åŒ…å« BOM çš„ UTF-8 æ–‡ä»¶
- âœ… èƒ½å¤Ÿè¯†åˆ«å¹¶è·³è¿‡å…ƒä¿¡æ¯è¡Œ
- âœ… èƒ½å¤Ÿæ¸…ç† Unnamed åˆ—
- âœ… èƒ½å¤Ÿè½¬æ¢æ•°æ®ç±»å‹ï¼ˆæ•°å€¼ã€æ—¥æœŸï¼‰
- âœ… èƒ½å¤Ÿè¿›è¡Œå®½è¡¨åˆ°é•¿è¡¨çš„è½¬æ¢
- âœ… ç»˜å›¾å‰ä¼šéªŒè¯åˆ—åå­˜åœ¨æ€§

---

## 4. ä¸‹ä¸€æ­¥å»ºè®®

### P1 ä¼˜å…ˆçº§ä»»åŠ¡ï¼ˆå¯é€‰ï¼‰
å¦‚æœéœ€è¦è¿›ä¸€æ­¥æå‡è‡ªåŠ¨åŒ–ç¨‹åº¦ï¼Œå¯ä»¥è€ƒè™‘ï¼š

1. **é€šç”¨æ¸…æ´—å‡½æ•°åº“**ï¼ˆ3å¤©å·¥ä½œé‡ï¼‰
   - åˆ›å»º `backend/src_agent/utils/data_cleaner.py`
   - å®ç° `clean_excel_data()` å‡½æ•°
   - è‡ªåŠ¨æ£€æµ‹ç¼–ç ã€è¡¨å¤´ä½ç½®ã€åˆ—åé—®é¢˜
   - é›†æˆåˆ°ç°æœ‰å·¥å…·ä¸­

2. **æ•°æ®éªŒè¯ API**ï¼ˆ2å¤©å·¥ä½œé‡ï¼‰
   - åˆ›å»º `POST /api/data/validate` ç«¯ç‚¹
   - è¿”å›æ–‡ä»¶é—®é¢˜åˆ—è¡¨å’Œä¿®å¤å»ºè®®
   - æä¾›äº¤äº’å¼ä¿®å¤é€‰é¡¹

### ç”¨æˆ·æ•™è‚²ï¼ˆæŒç»­ï¼‰
1. æä¾›ç¤ºä¾‹æ•°æ®å’Œæ¸…æ´—è„šæœ¬
2. å½•åˆ¶è§†é¢‘æ•™ç¨‹ï¼ˆå¯é€‰ï¼‰
3. æ”¶é›†ç”¨æˆ·åé¦ˆï¼Œè¿­ä»£æ”¹è¿›

---

## 5. æµ‹è¯•å»ºè®®

### 5.1 è‡ªåŠ¨åŒ–å›å½’æµ‹è¯•ï¼ˆå·²æ·»åŠ ï¼‰
- **è„šæœ¬**ï¼š`backend/tests/test_data_preprocessing.py`
- **è¦†ç›–ç‚¹**ï¼š
  1. LEGO Excelï¼šéªŒè¯è¡¨å¤´æ£€æµ‹ã€Unnamed åˆ—æ¸…ç†ä»¥åŠåˆ—åæ£€æŸ¥ï¼ˆå¯¹åº”ä»»åŠ¡ 4.2ï¼‰
  2. å¤šå±‚è¡¨å¤´ï¼šè¯»å– `data/test_multiheader.xlsx`ï¼Œç¡®è®¤ `header=3`ã€`skiprows` ç­‰ç­–ç•¥ï¼ˆå¯¹åº”ä»»åŠ¡ 4.3ï¼‰
  3. å®½è¡¨è½¬é•¿è¡¨ï¼šå¯¹ `data/test_wide.csv` è¿è¡Œ `melt` å¹¶æ ¡éªŒè¾“å‡ºå½¢çŠ¶ï¼ˆå¯¹åº”ä»»åŠ¡ 4.4ï¼‰
  4. Telco å›å½’ï¼šé€šè¿‡ `load_dataset('telco')` æ ¡éªŒæ ‡å‡†åŠŸèƒ½æ— å›å½’ï¼ˆå¯¹åº”ä»»åŠ¡ 4.5ï¼‰
- **è¿è¡Œæ–¹å¼**ï¼š
  ```bash
  cd backend
  ../.venv/bin/python -m unittest tests.test_data_preprocessing
  ```
- **ç»“æœ**ï¼š2025-11-18 æ‰§è¡Œé€šè¿‡ï¼ˆ5 ä¸ªæµ‹è¯•å…¨éƒ¨ PASSï¼‰ï¼Œè¾“å‡ºè¯¦æƒ…è§æœ¬æ¬¡ CI æ—¥å¿—ã€‚

### 5.2 LangGraph æ‰‹åŠ¨éªŒè¯ï¼ˆå»ºè®®ä¿ç•™ï¼‰
1. **LEGO æ•°æ®**
   ```
   è¯·åˆ†æ data/lego.xlsx æ–‡ä»¶ï¼Œå…ˆæ£€æŸ¥æ–‡ä»¶ç»“æ„ï¼Œ
   ç„¶åæ¸…æ´—æ•°æ®ï¼Œæœ€åç»˜åˆ¶å„ç³»åˆ—çš„é”€å”®å¯¹æ¯”å›¾ã€‚
   ```
   - é¢„æœŸï¼šAI é€æ­¥æ‰§è¡Œ header=None â†’ header=5 â†’ åˆ é™¤ Unnamed â†’ æ ¡éªŒåˆ—å â†’ ç»˜å›¾ã€‚

2. **å¤šå±‚è¡¨å¤´**
   ```
   è¯·è¯»å– data/test_multiheader.xlsxï¼Œå…ˆå±•ç¤ºå‰10è¡Œï¼Œ
   ç¡®è®¤çœŸå®è¡¨å¤´åé‡æ–°è¯»å–å¹¶å±•ç¤º DataFrame.info()ã€‚
   ```

3. **å®½è¡¨è½¬é•¿è¡¨**
   ```
   è¯·è¯»å– data/test_wide.csvï¼Œè½¬æ¢ä¸ºé•¿è¡¨æ ¼å¼ï¼Œ
   ç„¶åç»˜åˆ¶æ¯ä¸ªäº§å“çš„å­£åº¦è¶‹åŠ¿å›¾ã€‚
   ```

---

## 6. æ–‡ä»¶æ¸…å•

### ä¿®æ”¹çš„æ–‡ä»¶
- âœ… `backend/src_agent/prompt.py` - æ–°å¢110è¡Œæ•°æ®å¤„ç†æŒ‡å¯¼

### æ–°å¢çš„æ–‡ä»¶
- âœ… `backend/DATA_PREPARATION.md` - ç”¨æˆ·æ•°æ®å‡†å¤‡æŒ‡å—ï¼ˆ400è¡Œï¼‰
- âœ… `backend/DATA_PREPROCESSING_GUIDE.md` - æŠ€æœ¯æ–¹æ¡ˆæŒ‡å—ï¼ˆå·²å­˜åœ¨ï¼‰
- âœ… `backend/DATA_PREPROCESSING_P0_IMPLEMENTATION.md` - æœ¬å®æ–½æ€»ç»“

### ç›¸å…³æ–‡ä»¶
- ğŸ“‹ `backend/SUMMARIZATION_MIDDLEWARE_ANALYSIS.md` - ä¸­é—´ä»¶å…¼å®¹æ€§åˆ†æ
- ğŸ“‹ `backend/SANDBOX_IMPLEMENTATION.md` - æ²™ç®±å®ç°æ–‡æ¡£ï¼ˆåŒ…å«ä¸­æ–‡å­—ä½“æ”¯æŒï¼‰

---

## 7. æ€»ç»“

é€šè¿‡æœ¬æ¬¡ P0 ä¼˜å…ˆçº§å®æ–½ï¼Œæˆ‘ä»¬ï¼š

1. **ç«‹å³æ”¹å–„äº† AI çš„æ•°æ®å¤„ç†èƒ½åŠ›**
   - æ— éœ€ä¿®æ”¹ä»£ç ï¼Œä»…é€šè¿‡å¢å¼º prompt
   - AI ç°åœ¨æŒæ¡äº†å®Œæ•´çš„æ•°æ®é¢„å¤„ç†æœ€ä½³å®è·µ
   - èƒ½å¤Ÿä¸»åŠ¨æ£€æŸ¥ã€è¯Šæ–­å’Œä¿®å¤æ•°æ®é—®é¢˜

2. **é™ä½äº†ç”¨æˆ·ä½¿ç”¨é—¨æ§›**
   - æä¾›äº†è¯¦ç»†çš„ç”¨æˆ·æŒ‡å—
   - åŒ…å«å…·ä½“çš„ AI äº¤äº’ç¤ºä¾‹
   - è¦†ç›–å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆ

3. **å»ºç«‹äº†é€šç”¨çš„æ•°æ®å¤„ç†æ¡†æ¶**
   - ä¸ä»…è§£å†³äº† LEGO æ•°æ®é—®é¢˜
   - é€‚ç”¨äºæ‰€æœ‰å¤æ‚çš„ Excel/CSV æ–‡ä»¶
   - å¯æ‰©å±•åˆ°æ›´å¤šæ•°æ®æºå’Œåœºæ™¯

**é¢„è®¡å½±å“**ï¼š
- âœ… å‡å°‘å› æ•°æ®æ ¼å¼é—®é¢˜å¯¼è‡´çš„é”™è¯¯ **80%+**
- âœ… æå‡ç”¨æˆ·é¦–æ¬¡æˆåŠŸç‡ **æ˜¾è‘—æå‡**
- âœ… é™ä½æ•°æ®å‡†å¤‡æ—¶é—´ **50%+**

**å®æ–½æˆæœ¬**ï¼š
- å®é™…å·¥ä½œé‡ï¼šçº¦ **2-3 å°æ—¶**
- ä»£ç ä¿®æ”¹ï¼š**æœ€å°åŒ–**ï¼ˆä»… promptï¼‰
- é£é™©ï¼š**æä½**ï¼ˆä¸å½±å“ç°æœ‰åŠŸèƒ½ï¼‰

---

## 8. å¯ç”¨æ–°åŠŸèƒ½

æ–°çš„ prompt ä¼šåœ¨ä¸‹æ¬¡å¯åŠ¨ LangGraph æœåŠ¡æ—¶è‡ªåŠ¨åŠ è½½ã€‚

å¯åŠ¨æœåŠ¡ï¼š
```bash
cd /Users/kevin/dev/ai/ai-engineer-training/sample_data_agent/backend
source ../.venv/bin/activate
langgraph dev
```

æˆ–ä½¿ç”¨åå°è¿è¡Œï¼š
```bash
../.venv/bin/langgraph dev
```

---

## 9. å›¢é˜ŸåŸ¹è®­è®¡åˆ’ï¼ˆè¿›è¡Œä¸­ï¼‰

| æ­¥éª¤ | å†…å®¹ | è´Ÿè´£äºº | çŠ¶æ€ |
| --- | --- | --- | --- |
| 1 | 15 åˆ†é’Ÿæ¼”ç¤ºï¼šä½¿ç”¨ LEGO æ•°æ®å®Œæ•´èµ°ä¸€éâ€œä¸€åˆ†é’Ÿä¸Šæ‰‹æŒ‡å—â€ä¸ `tests.test_data_preprocessing` çš„è¿è¡Œç»“æœ | Kevin | ğŸ“… é¢„çº¦æœ¬å‘¨ä¾‹ä¼š |
| 2 | å®æ“ç»ƒä¹ ï¼šè®©å›¢é˜Ÿæˆå‘˜åœ¨ `data/test_multiheader.xlsx` ä¸Šå¤ç° `header=None â†’ header=3` æµç¨‹ | å…¨å‘˜ | å¾…æ‰§è¡Œ |
| 3 | åé¦ˆæ”¶é›†ï¼šä½¿ç”¨ Forms æ”¶é›†â€œæ˜¯å¦èƒ½åœ¨ 5 åˆ†é’Ÿå†…å®Œæˆæ¸…æ´—ï¼Ÿâ€ç­‰é—®é¢˜ï¼Œè®°å½•åœ¨ `DATA_PREPARATION.md` çš„å¯è¯»æ€§ç« èŠ‚ | PM | å¾…æ‰§è¡Œ |

> è¯´æ˜ï¼šåŸ¹è®­å®Œæˆåï¼Œå¯å°†åé¦ˆåŒæ­¥åˆ° `openspec/changes/improve-data-preprocessing-robustness/tasks.md` çš„ Phase 6.3 è®°å½•ä¸­ï¼Œä¾¿äºå½’æ¡£ã€‚

---

**å®æ–½å®Œæˆ** âœ…
