# 增强结构化文件分析引导系统

## Why

当前系统虽然可以通过 `python_inter` 和 `fig_inter` 处理数据文件，但对于复杂的文件格式（Excel多层表头、PPT、复杂嵌套结构等）缺乏系统化的分析引导。模型在遇到这些复杂场景时：

1. **缺乏结构化思考流程**：没有明确的步骤指导如何系统地分析文件结构、识别问题、制定处理策略
2. **分析质量不稳定**：对于多层表头、跨列表头、元信息混杂等复杂场景，缺少明确的最佳实践指导
3. **无法根据复杂度调整策略**：所有任务使用相同的处理流程，无法针对高复杂度任务使用更强大的模型或更严谨的分析流程

这导致用户在处理复杂数据文件时体验不一致，需要多次迭代才能获得正确的分析结果。

## What Changes

本提案将引入两个相互配合的新能力：

**1. 结构化文件分析工作流程（新能力：file-analysis）**
- 为复杂文件格式提供系统化的分析思维框架和检查清单
- 定义标准的分析阶段：文件检查 → 结构识别 → 问题诊断 → 策略制定 → 执行验证
- 为不同文件类型（Excel、CSV、JSON、PPT等）提供专门的分析指导文档
- 集成到 prompt.py，使模型自动遵循结构化分析流程

**2. 任务复杂度感知与模型选择（新能力：model-selection）**
- 根据文件复杂度和任务类型自动选择合适的模型
- 定义复杂度评估标准（多层表头、跨列结构、大文件、多格式混合等）
- 支持配置不同复杂度级别的模型策略
- 在关键分析阶段（结构识别、策略制定）可选择性使用更强模型

**影响范围：**
- 新增 2 个能力规范：`file-analysis` 和 `model-selection`
- 修改：`prompt.py`（增强分析指导）
- 新增：`doc/file_analysis_guide.md`（分析指导文档）
- 可选：模型配置机制（如果实现可配置模型选择）

## Impact

**受益场景：**
- Excel 多层表头文件分析
- 包含元信息行的复杂表格
- 宽表/长表转换需求
- 混合格式数据源
- 大型复杂数据文件

**兼容性：**
- 向后兼容：简单文件（单层表头CSV）继续使用快速流程
- 增强现有能力：不修改现有工具接口，仅增强分析引导
- 可配置：复杂度阈值和模型策略可根据需求调整

**性能考虑：**
- 简单任务：无额外开销（自动识别为低复杂度）
- 复杂任务：略增加分析时间（换取更高质量和成功率）
- 模型成本：仅在必要时使用高级模型

**受影响的规范：**
- 新增：`specs/file-analysis/spec.md`（文件分析能力）
- 新增：`specs/model-selection/spec.md`（模型选择能力）
- 关联：`specs/data-analysis/spec.md`（受益于更好的文件分析）
- 关联：`specs/code-execution/spec.md`（执行层面不变）
