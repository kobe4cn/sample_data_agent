# 实施任务清单

## 1. 规范设计与验证
- [ ] 1.1 完成 `file-analysis/spec.md` 规范编写
- [ ] 1.2 完成 `model-selection/spec.md` 规范编写
- [ ] 1.3 运行 `openspec validate add-structured-file-analysis-guidance --strict` 确保规范有效
- [ ] 1.4 评审规范，确认场景覆盖完整

## 2. 文件分析指导文档
- [ ] 2.1 创建 `backend/doc/file_analysis_guide.md`
  - Excel 多层表头分析检查清单
  - CSV 编码和分隔符诊断流程
  - 宽表/长表识别和转换策略
  - 常见错误模式和解决方案
- [ ] 2.2 为每种文件类型编写分析示例（含代码模板）
- [ ] 2.3 添加复杂度评估量化标准

## 3. Prompt 增强
- [ ] 3.1 在 `prompt.py` 中添加"文件分析系统化流程"章节
  - 集成 5 阶段分析框架
  - 添加复杂度自评指导
  - 嵌入检查清单引用
- [ ] 3.2 优化现有数据预处理章节，与新流程对齐
- [ ] 3.3 添加"何时查阅分析指导文档"的触发条件

## 4. 模型选择机制（可选实现）
- [ ] 4.1 设计复杂度评分算法
  - 多层表头：+3 分
  - 跨列结构：+2 分
  - 文件大小 >10MB：+2 分
  - 混合格式：+2 分
  - 总分 ≥5 触发高级模型
- [ ] 4.2 添加配置文件支持（`config/model_strategy.yaml`）
- [ ] 4.3 实现模型切换逻辑（如果 LangGraph 支持动态模型）
- [ ] 4.4 添加日志记录模型选择决策

## 5. 集成测试
- [ ] 5.1 准备测试数据集
  - 简单 CSV（基线）
  - Excel 多层表头（lego.xlsx）
  - 包含元信息的复杂表格
  - 宽表数据（需要 melt）
- [ ] 5.2 编写测试用例验证分析流程
- [ ] 5.3 验证向后兼容性（telco 数据集）
- [ ] 5.4 性能基准测试（简单 vs 复杂任务）

## 6. 文档与示例
- [ ] 6.1 更新 README.md 添加"复杂文件分析"章节
- [ ] 6.2 创建示例 Jupyter Notebook 演示分析流程
- [ ] 6.3 编写最佳实践文档（何时使用、如何配置）

## 7. 验证与部署
- [ ] 7.1 代码审查
- [ ] 7.2 用户验收测试（真实复杂文件）
- [ ] 7.3 性能监控设置（如需要）
- [ ] 7.4 部署到生产环境

## 依赖关系
- 任务 3 依赖任务 2（Prompt 引用指导文档）
- 任务 5 依赖任务 2、3（测试需要完整流程）
- 任务 4 可并行开发或后续迭代
